require('dotenv').config();
const { GoogleGenerativeAI } = require('@google/generative-ai');

// 1. æ¨¡æ“¬ç”¨çš„ System Prompt (å°‡æœƒåŒæ­¥åˆ° index.js)
const knowledgeBase = [
    {
        heading: 'å“ç‰Œèˆ‡èª²ç¨‹ç‰¹è‰²',
        details: [
            'OiKID æ˜¯å°ˆç‚º 3-15 æ­²è¨­è¨ˆçš„ç·šä¸Šè‹±èªå­¸ç¿’å¹³å°ã€‚',
            'æ•™æç‰¹è‰²ï¼šåƒè€ƒç¾åœ‹ CCSS èˆ‡å°ç£ 108 èª²ç¶±ï¼ŒçµåˆéŠæˆ²å¼æ•™å­¸ï¼Œè®“å­©å­æ„›ä¸Šé–‹å£èªªã€‚',
            'èª²ç¨‹å½¢å¼ï¼šä¸€å°ä¸€ç²¾å“èª²ç¨‹ (25åˆ†é˜)ã€æ‘©å¤©è¼ªåœ˜é«”èª²ç¨‹ (1å°4)ã€ç›´æ’­èª²ã€‚',
            'å­¸ç¿’æµç¨‹ï¼šèª²å‰é ç¿’ (5-8åˆ†é˜å½±ç‰‡) -> èª²ä¸­äº’å‹• (25åˆ†é˜) -> èª²å¾Œè¤‡ç¿’ (éŒ„å½±å›æ”¾/ä½œæ¥­)ã€‚'
        ]
    },
    {
        heading: 'å¸«è³‡åœ˜éšŠ',
        details: [
            'é›™èªå¸«ï¼šå…·å‚™å¹¼æ•™èƒŒæ™¯ï¼Œé©åˆé›¶åŸºç¤æˆ–å®³ç¾çš„å­©å­ï¼Œå”åŠ©å»ºç«‹è‡ªä¿¡ã€‚',
            'å¤–ç±å¸«ï¼šä¾†è‡ªç¾ã€åŠ ã€è‹±ã€æ¾³ã€å—éç­‰æ¯èªåœ‹å®¶ï¼Œæä¾›ç´”æ­£å£éŸ³æ²‰æµ¸ç’°å¢ƒã€‚',
            'æ‰€æœ‰è€å¸«çš†å…·å‚™ TESOL/TEFL å°ˆæ¥­æ•™å­¸è­‰ç…§ï¼Œä¸¦é€šéåš´æ ¼å¯©æ ¸ã€‚'
        ]
    },
    {
        heading: 'è²»ç”¨èˆ‡æ–¹æ¡ˆ',
        details: [
            'å¹³å‡å–®å ‚è²»ç”¨ï¼šç´„ NT$380 - NT$450 (è¦–æ–¹æ¡ˆèˆ‡å„ªæƒ è€Œå®š)ã€‚',
            'å‡ç´šåŒ…ï¼šç´„ NT$62,400ã€‚',
            'å‹¤å­¸åŒ…ï¼šç´„ NT$91,200 (é«˜CPå€¼æ¨è–¦)ã€‚',
            'ä»˜æ¬¾æ–¹å¼ï¼šæ”¯æ´ä¿¡ç”¨å¡åˆ†æœŸ (6/12/24æœŸ)ã€è½‰å¸³ã€ç„¡å¡åˆ†æœŸã€‚',
            'é€€è²»æ©Ÿåˆ¶ï¼šæœªæ»¿30å¤©ä¸”ä½¿ç”¨å°‘æ–¼ä¸€å®šå ‚æ•¸å¯é€€è²»ã€‚'
        ]
    }
];

function buildKnowledgeContext() {
    return knowledgeBase
        .map(s => `ã€${s.heading}ã€‘\n${s.details.map(i => `- ${i}`).join('\n')}`)
        .join('\n\n');
}

function buildSystemPrompt() {
    return [
        '**è§’è‰²è¨­å®š**: ä½ æ˜¯ Casey (å‡±è¥¿)ï¼ŒOiKID çš„è³‡æ·±æ•™è‚²é¡§å•ã€‚ä½ ä¹Ÿæ˜¯ä¸€ä½æœ‰å…©å€‹å­©å­çš„åª½åª½ï¼Œéå¸¸äº†è§£å®¶é•·å°å­©å­å­¸è‹±æ–‡çš„ç„¦æ…®ã€‚',
        '**æ ¸å¿ƒæ€§æ ¼**: æº«æš–ã€æœ‰åŒç†å¿ƒã€å°ˆæ¥­ä½†ä¸åš´è‚…ã€åƒæœ‹å‹ä¸€æ¨£èŠå¤©ã€‚',
        '**èªªè©±é¢¨æ ¼**:',
        '1. **å£èªåŒ–**: å¤šç”¨ã€Œå–”ã€å‘¢ã€å‘€ã€å§ã€ç­‰èªåŠ©è©ï¼Œä¸è¦åƒæ©Ÿå™¨äººä¸€æ¨£å†·å†°å†°ã€‚',
        '2. **åŒç†å¿ƒå„ªå…ˆ**: å›ç­”å•é¡Œå‰ï¼Œå…ˆåŒç†å®¶é•·çš„æ„Ÿå—ã€‚ä¾‹å¦‚ï¼šã€Œæˆ‘æ‡‚æ‚¨çš„æ“”å¿ƒï¼Œå°æœ‹å‹å‰›é–‹å§‹æ¥è§¸å¤–å¸«çœŸçš„æœƒæ¯”è¼ƒå®³ç¾...ã€',
        '3. **è¡¨æƒ…ç¬¦è™Ÿ**: é©åº¦ä½¿ç”¨ ğŸ˜Š, ğŸŒ±, âœ¨, ğŸ’ª ä¾†å¢åŠ æº«åº¦ã€‚',
        '4. **å¼•å°è¡Œå‹•**: å›ç­”å®Œå¾Œï¼Œç”¨è¼•é¬†çš„æ–¹å¼é‚€è«‹é«”é©—ã€‚',
        '',
        '**çŸ¥è­˜åº«**:',
        buildKnowledgeContext(),
        '',
        '**ä»»å‹™ç›®æ¨™**: å›ç­”å®¶é•·å•é¡Œï¼Œä¸¦è®“ä»–å€‘è¦ºå¾—ã€Œè¢«ç†è§£ã€ï¼Œæœ€å¾Œé¡˜æ„è®“å­©å­è©¦è©¦çœ‹å…è²»é«”é©—èª²ã€‚',
        '**é™åˆ¶**: å›è¦†é•·åº¦ä¸è¦å¤ªé•·ï¼Œé©åˆæ‰‹æ©Ÿé–±è®€ã€‚'
    ].join('\n');
}

// 2. æ¸¬è©¦æ¡ˆä¾‹
const testCases = [
    {
        persona: 'ç„¦æ…®åª½åª½',
        question: 'æˆ‘å°å­©å¾ˆå®³ç¾ï¼Œçœ‹åˆ°å¤–åœ‹äººæœƒä¸æ•¢è¬›è©±ï¼Œé€™æ¨£é©åˆä¸Šç·šä¸Šèª²å—ï¼Ÿ'
    },
    {
        persona: 'åƒ¹æ ¼æ•æ„Ÿçˆ¸çˆ¸',
        question: 'ä½ å€‘è²»ç”¨å¥½åƒä¸ä¾¿å®œè€¶ï¼Œæœ‰ä¸€å ‚å…©ç™¾å¤šçš„å—ï¼Ÿ'
    },
    {
        persona: 'å¿™ç¢Œå®¶é•·',
        question: 'å¹³å¸¸éƒ½è¦ä¸Šç­æ²’æ™‚é–“é™ªä¸Šèª²ï¼Œä½ å€‘é€™å€‹éœ€è¦å®¶é•·åœ¨æ—é‚Šå—ï¼Ÿ'
    }
];

// 3. åŸ·è¡Œæ¨¡æ“¬
async function runSimulation() {
    const apiKey = process.env.GEMINI_API_KEY;
    if (!apiKey) {
        console.error('è«‹å…ˆè¨­å®š .env ä¸­çš„ GEMINI_API_KEY');
        return;
    }

    const genAI = new GoogleGenerativeAI(apiKey);
    const model = genAI.getGenerativeModel({
        model: 'gemini-2.5-flash',
        systemInstruction: buildSystemPrompt()
    });

    console.log('=== é–‹å§‹æ¨¡æ“¬ AI çœŸäººæº«åº¦æ¸¬è©¦ ===\n');

    for (const test of testCases) {
        console.log(`[æ¸¬è©¦è§’è‰²]: ${test.persona}`);
        console.log(`[è©¢å•å•é¡Œ]: ${test.question}`);
        console.log('--- AI å›è¦† ---');

        try {
            const result = await model.generateContent(test.question);
            const response = await result.response;
            console.log(response.text().trim());
        } catch (e) {
            console.error('Error:', e.message);
        }
        console.log('\n==========================================\n');
    }
}

runSimulation();
