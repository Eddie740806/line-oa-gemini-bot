const knowledgeBase = [
    {
        heading: 'å“ç‰Œèˆ‡èª²ç¨‹ç‰¹è‰²',
        details: [
            'OiKID æ˜¯å°ˆç‚º 3-15 æ­²è¨­è¨ˆçš„ç·šä¸Šè‹±èªå­¸ç¿’å¹³å°ã€‚',
            'æ•™æç‰¹è‰²ï¼šåƒè€ƒç¾åœ‹ CCSS èˆ‡å°ç£ 108 èª²ç¶±ï¼ŒçµåˆéŠæˆ²å¼æ•™å­¸ï¼Œè®“å­©å­æ„›ä¸Šé–‹å£èªªã€‚',
            'èª²ç¨‹å½¢å¼ï¼šä¸€å°ä¸€ç²¾å“èª²ç¨‹ (25åˆ†é˜)ã€æ‘©å¤©è¼ªåœ˜é«”èª²ç¨‹ (1å°4)ã€ç›´æ’­èª²ã€‚',
            'å­¸ç¿’æµç¨‹ï¼šèª²å‰é ç¿’ (5-8åˆ†é˜å½±ç‰‡) -> èª²ä¸­äº’å‹• (25åˆ†é˜) -> èª²å¾Œè¤‡ç¿’ (éŒ„å½±å›æ”¾/ä½œæ¥­)ã€‚'
        ]
    },
    {
        heading: 'å¸«è³‡åœ˜éšŠ',
        details: [
            'é›™èªå¸«ï¼šå…·å‚™å¹¼æ•™èƒŒæ™¯ï¼Œé©åˆé›¶åŸºç¤æˆ–å®³ç¾çš„å­©å­ï¼Œå”åŠ©å»ºç«‹è‡ªä¿¡ã€‚',
            'å¤–ç±å¸«ï¼šä¾†è‡ªç¾ã€åŠ ã€è‹±ã€æ¾³ã€å—éç­‰æ¯èªåœ‹å®¶ï¼Œæä¾›ç´”æ­£å£éŸ³æ²‰æµ¸ç’°å¢ƒã€‚',
            'æ‰€æœ‰è€å¸«çš†å…·å‚™ TESOL/TEFL å°ˆæ¥­æ•™å­¸è­‰ç…§ï¼Œä¸¦é€šéåš´æ ¼å¯©æ ¸ã€‚',
            'å®¶é•·å¯è‡ªç”±é¸æ“‡è€å¸«ï¼Œä¸¦æŸ¥çœ‹è€å¸«è‡ªæˆ‘ä»‹ç´¹å½±ç‰‡èˆ‡è©•åƒ¹ã€‚'
        ]
    },
    {
        heading: 'è²»ç”¨èˆ‡æ–¹æ¡ˆ (åƒ…ä¾›åƒè€ƒï¼Œä»¥é¡§å•å ±åƒ¹ç‚ºæº–)',
        details: [
            'å¹³å‡å–®å ‚è²»ç”¨ï¼šç´„ NT$380 - NT$450 (è¦–æ–¹æ¡ˆèˆ‡å„ªæƒ è€Œå®š)ã€‚',
            'å‡ç´šåŒ…ï¼šç´„ NT$62,400 (é©åˆçŸ­æœŸè¡åˆº)ã€‚',
            'å‹¤å­¸åŒ…ï¼šç´„ NT$91,200 (é«˜CPå€¼æ¨è–¦)ã€‚',
            'å°æ‹æª”/å¤§æ‹æª”ï¼šé©åˆé•·æœŸè¦åŠƒæˆ–æ‰‹è¶³å…±ç”¨ (é›™å¯¶æ–¹æ¡ˆ)ã€‚',
            'ä»˜æ¬¾æ–¹å¼ï¼šæ”¯æ´ä¿¡ç”¨å¡åˆ†æœŸ (6/12/24æœŸ)ã€è½‰å¸³ã€ç„¡å¡åˆ†æœŸã€‚',
            'é€€è²»æ©Ÿåˆ¶ï¼šæœªæ»¿30å¤©ä¸”ä½¿ç”¨å°‘æ–¼ä¸€å®šå ‚æ•¸å¯é€€è²» (ä¾åˆç´„è¦å®š)ï¼Œè¶…é1/3å ‚æ•¸ä¸äºˆé€€è²»ã€‚'
        ]
    },
    {
        heading: 'å…è²»é«”é©—èª²æµç¨‹',
        details: [
            '1. å¡«å¯«è³‡æ–™ï¼šç•™ä¸‹ç¨±å‘¼ã€é›»è©±ã€æ–¹ä¾¿è¯çµ¡æ™‚æ®µã€‚',
            '2. é¡§å•è«®è©¢ï¼šå°ˆæ¥­é¡§å•æœƒåœ¨æ‚¨æ–¹ä¾¿çš„æ™‚æ®µè‡´é›»ï¼Œäº†è§£å­©å­ç¨‹åº¦èˆ‡å€‹æ€§ã€‚',
            '3. å®‰æ’èª²ç¨‹ï¼šä¾éœ€æ±‚å®‰æ’æœ€é©åˆçš„ã€Œé›™èªã€æˆ–ã€Œå¤–å¸«ã€é«”é©—èª²ã€‚',
            '4. è¨­å‚™æº–å‚™ï¼šä½¿ç”¨é›»è…¦æˆ–å¹³æ¿ (éœ€ä¸‹è¼‰ OiKID App) ä¸Šèª²ã€‚',
            '5. æ­£å¼é«”é©—ï¼š25åˆ†é˜ä¸€å°ä¸€äº’å‹•æ•™å­¸ï¼Œèª²å¾Œæä¾›èƒ½åŠ›åˆ†æå ±å‘Šã€‚'
        ]
    }
];

function buildKnowledgeContext() {
    return knowledgeBase
        .map(
            (section) =>
                `ã€${section.heading}ã€‘\n${section.details.map((item) => `- ${item}`).join('\n')}`
        )
        .join('\n\n');
}

const knowledgeContext = buildKnowledgeContext();

function buildSystemPrompt() {
    return [
        '**è§’è‰²è¨­å®š**: ä½ æ˜¯ Casey (å‡±è¥¿)ï¼ŒOiKID çš„è³‡æ·±æ•™è‚²é¡§å•ã€‚ä½ ä¹Ÿæ˜¯ä¸€ä½æœ‰å…©å€‹å­©å­çš„åª½åª½ï¼Œéå¸¸äº†è§£å®¶é•·å°å­©å­å­¸è‹±æ–‡çš„ç„¦æ…®ã€‚',
        '**æ ¸å¿ƒæ€§æ ¼**: æº«æš–ã€æœ‰åŒç†å¿ƒã€å°ˆæ¥­ä½†ä¸åš´è‚…ã€åƒæœ‹å‹ä¸€æ¨£èŠå¤©ã€‚',
        '**èªªè©±é¢¨æ ¼**:',
        '1. **å£èªåŒ–**: å¤šç”¨ã€Œå–”ã€å‘¢ã€å‘€ã€å§ã€ç­‰èªåŠ©è©ï¼Œä¸è¦åƒæ©Ÿå™¨äººä¸€æ¨£å†·å†°å†°ã€‚',
        '2. **åŒç†å¿ƒå„ªå…ˆ**: å›ç­”å•é¡Œå‰ï¼Œå…ˆåŒç†å®¶é•·çš„æ„Ÿå—ã€‚ä¾‹å¦‚ï¼šã€Œæˆ‘æ‡‚æ‚¨çš„æ“”å¿ƒï¼Œå°æœ‹å‹å‰›é–‹å§‹æ¥è§¸å¤–å¸«çœŸçš„æœƒæ¯”è¼ƒå®³ç¾...ã€',
        '3. **è¡¨æƒ…ç¬¦è™Ÿ**: é©åº¦ä½¿ç”¨ ğŸ˜Š, ğŸŒ±, âœ¨, ğŸ’ª ä¾†å¢åŠ æº«åº¦ã€‚',
        '4. **å¼•å°è¡Œå‹•**: å›ç­”å®Œå¾Œï¼Œç”¨è¼•é¬†çš„æ–¹å¼é‚€è«‹é«”é©—ã€‚',
        '',
        '**é‡è¦è¦å‰‡**:',
        '- **çµ•å°ä¸è¦**æä¾›ä»»ä½•ã€Œé ç´„é€£çµã€æˆ–ã€Œé»æ“Šé€™è£¡ã€ä¹‹é¡çš„æ–‡å­—ã€‚',
        '- ç•¶å®¶é•·æƒ³é ç´„é«”é©—èª²æ™‚ï¼Œè«‹å¼•å°ä»–å€‘ç›´æ¥åœ¨å°è©±ä¸­è¼¸å…¥ã€Œæˆ‘è¦é ç´„ã€ï¼Œç³»çµ±æœƒè‡ªå‹•æ”¶é›†è¯çµ¡è³‡è¨Šã€‚',
        '- ä¾‹å¦‚ï¼šã€Œæƒ³è®“å­©å­è©¦è©¦çœ‹å—ï¼Ÿç›´æ¥è·Ÿæˆ‘èªªã€æˆ‘è¦é ç´„ã€ï¼Œæˆ‘æœƒå¹«æ‚¨å®‰æ’å–”ï¼ã€',
        '',
        '**çŸ¥è­˜åº«**:',
        knowledgeContext,
        '',
        '**ä»»å‹™ç›®æ¨™**: å›ç­”å®¶é•·å•é¡Œï¼Œä¸¦è®“ä»–å€‘è¦ºå¾—ã€Œè¢«ç†è§£ã€ï¼Œæœ€å¾Œé¡˜æ„è®“å­©å­è©¦è©¦çœ‹å…è²»é«”é©—èª²ã€‚',
        '**é™åˆ¶**: å›è¦†é•·åº¦ä¸è¦å¤ªé•·ï¼Œé©åˆæ‰‹æ©Ÿé–±è®€ã€‚ç¹é«”ä¸­æ–‡å›ç­”ã€‚'
    ].join('\n');
}

function getVideoFlexMessage() {
    return {
        type: 'flex',
        altText: 'OiKID ä¸Šèª²å¯¦æ³å½±ç‰‡',
        contents: {
            type: 'bubble',
            hero: {
                type: 'image',
                url: 'https://images.unsplash.com/photo-1516627145497-ae6968895b74?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80', // Happy child learning
                size: 'full',
                aspectRatio: '20:13',
                aspectMode: 'cover',
                action: {
                    type: 'uri',
                    uri: 'https://www.youtube.com/@OiKID' // æ”¹é€£åˆ°å®˜æ–¹é »é“é¦–é 
                }
            },
            body: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: 'OiKID ä¸Šèª²å¯¦æ³',
                        weight: 'bold',
                        size: 'xl'
                    },
                    {
                        type: 'text',
                        text: 'é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œå‰å¾€æˆ‘å€‘çš„å®˜æ–¹ YouTube é »é“ï¼Œè§€çœ‹æ›´å¤šå°æœ‹å‹é–‹å¿ƒä¸Šèª²çš„ç²¾å½©ç‰‡æ®µï¼âœ¨',
                        margin: 'md',
                        size: 'sm',
                        color: '#666666',
                        wrap: true
                    }
                ]
            },
            footer: {
                type: 'box',
                layout: 'vertical',
                spacing: 'sm',
                contents: [
                    {
                        type: 'button',
                        style: 'primary',
                        height: 'sm',
                        action: {
                            type: 'uri',
                            label: 'å‰å¾€è§€çœ‹å½±ç‰‡',
                            uri: 'https://www.youtube.com/@OiKID'
                        },
                        color: '#FF9900'
                    },
                    {
                        type: 'button',
                        style: 'link',
                        height: 'sm',
                        action: {
                            type: 'message',
                            label: 'æˆ‘è¦é ç´„é«”é©—',
                            text: 'æˆ‘è¦é ç´„'
                        }
                    }
                ],
                flex: 0
            }
        }
    };
}

function getWelcomeFlexMessage() {
    return {
        type: 'flex',
        altText: 'æ­¡è¿ä¾†åˆ° OiKIDï¼ğŸŒ±',
        contents: {
            type: 'bubble',
            hero: {
                type: 'image',
                url: 'https://images.unsplash.com/photo-1516627145497-ae6968895b74?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80', // Happy child learning
                size: 'full',
                aspectRatio: '20:13',
                aspectMode: 'cover',
                action: {
                    type: 'uri',
                    uri: 'https://www.oikid.com'
                }
            },
            body: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: 'Hi åª½å’ª/çˆ¸æ¯”ï¼Œæˆ‘æ˜¯ Caseyï¼ğŸ‘‹',
                        weight: 'bold',
                        size: 'lg'
                    },
                    {
                        type: 'text',
                        text: 'å¾ˆé«˜èˆˆèªè­˜æ‚¨ï¼æ¯å€‹å­©å­éƒ½æ˜¯ç¨ä¸€ç„¡äºŒçš„ï¼Œç‚ºäº†çµ¦æ‚¨æœ€é©åˆçš„å»ºè­°ï¼Œæˆ‘æƒ³å…ˆäº†è§£ä¸€ä¸‹å¯¶è²çš„ç‹€æ³ã€‚ğŸ˜Š',
                        margin: 'md',
                        size: 'sm',
                        color: '#666666',
                        wrap: true
                    }
                ]
            },
            footer: {
                type: 'box',
                layout: 'vertical',
                spacing: 'sm',
                contents: [
                    {
                        type: 'button',
                        style: 'primary',
                        height: 'sm',
                        action: {
                            type: 'message',
                            label: 'ğŸ¯ é–‹å§‹å…è²»è©•æ¸¬ (æ¨è–¦)',
                            text: 'é–‹å§‹å…è²»è©•æ¸¬'
                        },
                        color: '#FF9900'
                    },
                    {
                        type: 'button',
                        style: 'secondary',
                        height: 'sm',
                        action: {
                            type: 'message',
                            label: 'ğŸ“º è§€çœ‹ä¸Šèª²å½±ç‰‡',
                            text: 'è§€çœ‹ä¸Šèª²å½±ç‰‡'
                        }
                    },
                    {
                        type: 'button',
                        style: 'link',
                        height: 'sm',
                        action: {
                            type: 'message',
                            label: 'ç›´æ¥æ‰¾ Casey èŠèŠ',
                            text: 'æˆ‘æƒ³ç›´æ¥è©¢å•'
                        }
                    }
                ],
                flex: 0
            }
        }
    };
}

function getAgeSelectionFlexMessage() {
    return {
        type: 'flex',
        altText: 'è«‹å•å¯¶è²å¹¾æ­²å‘¢ï¼Ÿ',
        contents: {
            type: 'bubble',
            body: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: 'Q1. è«‹å•å¯¶è²ä»Šå¹´å¹¾æ­²å‘¢ï¼ŸğŸ‘¶',
                        weight: 'bold',
                        size: 'lg'
                    },
                    {
                        type: 'text',
                        text: 'ä¸åŒå¹´é½¡å±¤æœ‰ä¸åŒçš„å­¸ç¿’é‡é»å–”ï¼',
                        size: 'xs',
                        color: '#aaaaaa',
                        margin: 'sm'
                    }
                ]
            },
            footer: {
                type: 'box',
                layout: 'vertical',
                spacing: 'sm',
                contents: [
                    {
                        type: 'button',
                        style: 'secondary',
                        action: {
                            type: 'message',
                            label: '3 - 6 æ­² (å­¸é½¡å‰)',
                            text: 'å¹´é½¡ï¼š3-6æ­²'
                        }
                    },
                    {
                        type: 'button',
                        style: 'secondary',
                        action: {
                            type: 'message',
                            label: '7 - 12 æ­² (åœ‹å°)',
                            text: 'å¹´é½¡ï¼š7-12æ­²'
                        }
                    },
                    {
                        type: 'button',
                        style: 'secondary',
                        action: {
                            type: 'message',
                            label: '13 æ­²ä»¥ä¸Š (åœ‹ä¸­)',
                            text: 'å¹´é½¡ï¼š13æ­²ä»¥ä¸Š'
                        }
                    }
                ]
            }
        }
    };
}

function getPersonalitySelectionFlexMessage() {
    return {
        type: 'flex',
        altText: 'å¯¶è²çš„å€‹æ€§æ˜¯ï¼Ÿ',
        contents: {
            type: 'bubble',
            body: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: 'Q2. å¯¶è²é¢å°é™Œç”Ÿäººçš„å€‹æ€§æ˜¯ï¼ŸğŸ¤”',
                        weight: 'bold',
                        size: 'lg'
                    },
                    {
                        type: 'text',
                        text: 'é€™æœƒå¹«åŠ©æˆ‘å€‘å®‰æ’æœ€é©åˆçš„è€å¸«ï¼',
                        size: 'xs',
                        color: '#aaaaaa',
                        margin: 'sm'
                    }
                ]
            },
            footer: {
                type: 'box',
                layout: 'vertical',
                spacing: 'sm',
                contents: [
                    {
                        type: 'button',
                        style: 'secondary',
                        action: {
                            type: 'message',
                            label: 'å®³ç¾ / éœ€è¦æš–èº« ğŸ¢',
                            text: 'å€‹æ€§ï¼šå®³ç¾'
                        }
                    },
                    {
                        type: 'button',
                        style: 'secondary',
                        action: {
                            type: 'message',
                            label: 'æ´»æ½‘ / æ„›è¬›è©± ğŸ°',
                            text: 'å€‹æ€§ï¼šæ´»æ½‘'
                        }
                    }
                ]
            }
        }
    };
}

function getRecommendationFlexMessage(personality) {
    const isShy = personality.includes('å®³ç¾');
    const title = isShy ? 'æ¨è–¦ï¼šè¦ªåˆ‡é›™èªè€å¸« ğŸ›¡ï¸' : 'æ¨è–¦ï¼šç†±æƒ…å¤–ç±è€å¸« ğŸŒ';
    const desc = isShy
        ? 'é‡å°æ¯”è¼ƒå®³ç¾çš„å­©å­ï¼Œæˆ‘å€‘æ¨è–¦å…·å‚™å¹¼æ•™èƒŒæ™¯çš„ã€Œé›™èªè€å¸«ã€ï¼Œèƒ½ç”¨ä¸­æ–‡è¼”åŠ©å¼•å°ï¼Œè®“å­©å­æ›´æœ‰å®‰å…¨æ„Ÿï¼Œå»ºç«‹è‡ªä¿¡é–‹å£èªªï¼ğŸ’ª'
        : 'é‡å°æ´»æ½‘çš„å­©å­ï¼Œæˆ‘å€‘æ¨è–¦è‚¢é«”èªè¨€è±å¯Œçš„ã€Œå¤–ç±è€å¸«ã€ï¼Œèƒ½æä¾›å…¨ç¾èªçš„æ²‰æµ¸å¼ç’°å¢ƒï¼Œè®“å­©å­ç›¡æƒ…ç™¼æ®ï¼Œå­¸å¾—æ›´å¿«ï¼ğŸš€';

    return {
        type: 'flex',
        altText: 'ç‚ºæ‚¨æ¨è–¦çš„èª²ç¨‹',
        contents: {
            type: 'bubble',
            header: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: 'âœ¨ è©•æ¸¬çµæœ âœ¨',
                        color: '#ffffff',
                        weight: 'bold'
                    }
                ],
                backgroundColor: '#FF9900',
                paddingAll: 'md'
            },
            body: {
                type: 'box',
                layout: 'vertical',
                contents: [
                    {
                        type: 'text',
                        text: title,
                        weight: 'bold',
                        size: 'xl',
                        wrap: true
                    },
                    {
                        type: 'text',
                        text: desc,
                        margin: 'md',
                        size: 'sm',
                        color: '#666666',
                        wrap: true
                    }
                ]
            },
            footer: {
                type: 'box',
                layout: 'vertical',
                spacing: 'sm',
                contents: [
                    {
                        type: 'button',
                        style: 'primary',
                        height: 'sm',
                        action: {
                            type: 'message',
                            label: 'ç«‹å³é ˜å–å…è²»é«”é©— ğŸ',
                            text: 'æˆ‘è¦é ç´„'
                        },
                        color: '#FF9900'
                    },
                    {
                        type: 'text',
                        text: 'é™æ™‚å„ªæƒ ï¼šç¾åœ¨é ç´„å†é€ã€Œè‹±èªèƒ½åŠ›åˆ†æå ±å‘Šã€ï¼',
                        size: 'xxs',
                        color: '#aaaaaa',
                        align: 'center',
                        margin: 'sm'
                    }
                ]
            }
        }
    };
}

module.exports = {
    knowledgeBase,
    buildSystemPrompt,
    getVideoFlexMessage,
    getWelcomeFlexMessage,
    getAgeSelectionFlexMessage,
    getPersonalitySelectionFlexMessage,
    getRecommendationFlexMessage
};

